{% extends "base.html" %}

{% block content %}
  <h2>Danh sách video mới nhất</h2>

  {% if videos %}
    {% for video in videos %}
      <div class="video-card">
        <h3>{{ video.title }}</h3>
        
        <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;">
          <iframe src="{{ video.embed_url }}" 
                  frameborder="0" 
                  allowfullscreen 
                  style="position:absolute;top:0;left:0;width:100%;height:100%;">
          </iframe>
        </div>
        
        <p>Thể loại: {{ video.category }}</p>
        <p>Người đăng: {{ video.uploader }}</p>
        <p>Ngày đăng: {{ video.upload_date.strftime('%d/%m/%Y') }}</p>

        <form action="{{ url_for('like_video', video_id=video.id) }}" method="post" style="display:inline;">
          <button type="submit"><i class="fa fa-thumbs-up"></i> {{ video.likes }}</button>
        </form>

        <form action="{{ url_for('dislike_video', video_id=video.id) }}" method="post" style="display:inline;">
          <button type="submit"><i class="fa fa-thumbs-down"></i> {{ video.dislikes }}</button>
        </form>

        {% if session.get('is_admin') %}
          <form action="{{ url_for('delete_video', video_id=video.id) }}" method="post" style="display:inline;">
            <button type="submit" onclick="return confirm('Bạn chắc chắn muốn xoá video này?')">Xoá</button>
          </form>
        {% endif %}

        <div>
          <h4>Bình luận:</h4>
          {% for comment in video.comments %}
            <p><strong>{{ comment.user }}:</strong> {{ comment.text }}</p>
          {% endfor %}

          <form action="{{ url_for('comment_video', video_id=video.id) }}" method="post">
            <input type="text" name="comment" placeholder="Viết bình luận..." required>
            <button type="submit">Gửi</button>
          </form>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>Chưa có video nào được đăng.</p>
  {% endif %}
{% endblock %}
